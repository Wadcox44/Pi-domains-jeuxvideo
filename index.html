<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeuxvideo.pi | Future Gaming Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet">
    
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    
    <style>
        :root { --pi-gold: #ffaa00; --bg-dark: #080808; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-dark); color: white; text-align: center; padding: 20px; }
        .container { max-width: 500px; margin: auto; background: #111; padding: 25px; border-radius: 24px; border: 1px solid #222; }
        h1 { font-size: 2.5em; margin-bottom: 20px; }
        #pay_button { 
            width: 100%; padding: 15px; background: var(--pi-gold); color: black; 
            border: none; border-radius: 12px; font-weight: bold; cursor: pointer; 
            font-size: 1.1em; margin-top: 20px;
        }
        #status-box { margin-top: 15px; font-size: 0.9em; color: #888; }
    </style>
</head>
<body>

    <div class="container">
        <h1>jeuxvideo<span style="color:var(--pi-gold)">.pi</span></h1>
        
        <div style="background:#6c5ce7; padding:15px; border-radius:12px; font-weight:bold;">
            üéÆ CLIQUE ICI POUR JOUER (BETA)
        </div>

        <div id="status-box">Initialisation du SDK...</div>

        <button id="pay_button">Donner 1 Pi pour le projet</button>
    </div>

    <script>
        // A. Initialisation
        const Pi = window.Pi;
        Pi.init({ version: "2.0", sandbox: true });

        const statusBox = document.getElementById('status-box');

        // B. Authentification automatique au chargement
        async function authUser() {
            try {
                const scopes = ['payments', 'username'];
                const auth = await Pi.authenticate(scopes, onIncompletePaymentFound);
                statusBox.innerHTML = "Connect√© en tant que : " + auth.user.username;
                statusBox.style.color = "#ffaa00";
            } catch (err) {
                statusBox.innerHTML = "Erreur d'auth : Ouvrez dans le Pi Browser";
                console.error(err);
            }
        }

        // Gestion des paiements interrompus
        function onIncompletePaymentFound(payment) {
            console.log("Paiement incomplet trouv√©", payment);
        };

        // C. La fonction de paiement
        document.getElementById('pay_button').addEventListener('click', async function() {
            try {
                statusBox.innerHTML = "Cr√©ation du paiement...";
                const payment = await Pi.createPayment({
                    amount: 1, // Le montant que tu as choisi
                    memo: "Soutien pour jeuxvideo.pi",
                    metadata: { type: "donation" },
                }, {
                    onReadyForServerApproval: function(paymentId) { console.log("Pr√™t pour approbation", paymentId); },
                    onReadyForServerCompletion: function(paymentId, txid) { console.log("Paiement compl√©t√©", txid); },
                    onCancel: function(paymentId) { statusBox.innerHTML = "Paiement annul√©"; },
                    onError: function(error, payment) { console.error(error); }
                });
            } catch (error) {
                alert("Erreur de paiement : " + error.message);
            }
        });

        // Lancement de l'authentification
        authUser();
    </script>
</body>
</html>
